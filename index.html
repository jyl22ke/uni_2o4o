<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=0.5">
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <link rel="shortcut icon" href="#" type="image/x-icon">
  <link rel="icon" href="#" type="image/x-icon">
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />        
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script> 
  <script src="http://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>      
  
  <style type="text/css">

	input,button{font-size:14px; text-align:center; font-weight:bold;}
	input:focus,#ctg:focus{outline:none;}

	*{margin:0;padding:0px;list-style:none;text-decoration:none;}
	body{font-size:100%;}
	.container{width:100%; min-height: 950px;}
	.canvas {
		background: url(./bga.jpg) fixed;
		display:grid; 
		grid-template-columns: repeat(15,30px);
		padding: 20px;
		background-size:cover; 
		grid-gap: 0px;
		text-align:center;
		}
	.insrt {height: 40px;}
	.ifo {margin: 5px; font-size: 1.0em; height: 20px;}
	.sjt {grid-column: 1/span 3;grid-row: 2/span 5; color: #000; font-weight: bold;border:1px solid black;}
	.sjo,.sjot,.sjat,.sjbt {grid-column: span 3;grid-row: span 1; color: #000; font-weight: bold;border:1px solid black;min-height:30px;}
	.sja,.sjb {grid-column: span 3;grid-row: span 1; color: #000; border:1px solid black;min-height:30px; font-size: 0.8em;}
	.sj {grid-column: span 3;grid-row: span 1; color: #000; font-weight: bold;border:1px solid black;height:60px;font-size:3.0em; font-family:"한양해서";}
	#output { min-height: 790px; color: #000; padding:10px;border:1px solid black;text-align:left; font-size: 0.8em;max-width:960px;}
	#output2 { display: none; float: left; min-height: 400px; color: #000; padding:10px;border:1px solid black;text-align:left; font-size: 0.8em; width:400px;}
	#submit1 {padding: 0 10px; font-weight: bold;}
	#clear1 {padding: 0 5px;}
	@media screen and (min-width: 950px) {.canvas {float: left;} #output {float: right;min-width:800px;} #output2 {display: flex;}}

  </style>

 </head>
 <body>
<div id="dvCSV">
</div>    

<!-- 메인메뉴 mmenu part -->
<div class="container">
	<div class="insrt">
		<p class="ifo"> 사주: <input type="text" id="sj" class="ifo" maxlength="8"> &nbsp; &nbsp;<button id="clear1">지우기</button> &nbsp; &nbsp;<button id="submit1">제 출</button></p><br/> 
	</div>
<hr/>
	<div class="canvas">

		<div class="sjat">십성(간)</div>
		<div class="sja" id="sj7a"></div>
		<div class="sja" id="sj5a"></div>
		<div class="sja" id="sj3a"></div>
		<div class="sja" id="sj1a"></div>
		<div class="sjt">사주</div>
		<div class="sjot">시</div>
		<div class="sjot">일</div>
		<div class="sjot">월</div>
		<div class="sjot">년</div>
		<div class="sj" id="sj7"></div>
		<div class="sj" id="sj5"></div>
		<div class="sj" id="sj3"></div>
		<div class="sj" id="sj1"></div>
		<div class="sjo" id="sjg7"></div>
		<div class="sjo" id="sjg5"></div>
		<div class="sjo" id="sjg3"></div>
		<div class="sjo" id="sjg1"></div>
		<div class="sj" id="sj8"></div>
		<div class="sj" id="sj6"></div>
		<div class="sj" id="sj4"></div>
		<div class="sj" id="sj2"></div>
		<div class="sjo" id="sjg8"></div>
		<div class="sjo" id="sjg6"></div>
		<div class="sjo" id="sjg4"></div>
		<div class="sjo" id="sjg2"></div>
		<div class="sjat">십성(지)</div>
		<div class="sja" id="sj8a"></div>
		<div class="sja" id="sj6a"></div>
		<div class="sja" id="sj4a"></div>
		<div class="sja" id="sj2a"></div>
		<div class="sjbt">지장간</div>
		<div class="sjb" id="sj8b"></div>
		<div class="sjb" id="sj6b"></div>
		<div class="sjb" id="sj4b"></div>
		<div class="sjb" id="sj2b"></div>

	</div>
	<div id="output"></div>
	<div id="output2"></div>
</div>
	
<script type="text/javascript">

fread("ohang");
fread("gan");
fread("jiji");
fread("sibsungX1");
fread("sig_chung");
fread("ganji_habchung");
fread("dgan_charac");
fread("dgabja60_charac");
fread("mjdjss_charac");
fread("habhwa");
	
function fread(fn){
    $(function (){
	var fileName = "./" + fn + ".csv";	// 파일 이름

	$.ajax({
		url:fileName,
		dataType:'text',
		success: function(da) {
			var textLine = '<script type="text/javascript">var ' + fn + '=[';
                        var rows = da.split('\n');
                        for (var i = 0; i < rows.length; i++) {
				if (i == 0){textLine += '['}else{textLine += ',['};
				var cells = rows[i].split(',');
                                for (var j = 0; j < cells.length; j++) {
					textLine += '"';
					textLine += cells[j].trim();;
					if (j == cells.length-1){textLine += '"'}else{textLine += '",'};
				}
				textLine += ']';
			}	
			textLine += ']';			
			$('#dvCSV').append(textLine);
		}
	});
    });
};
</script>

<script type="text/javascript">
	var saju = "";
	var sj_yg = ""; var sj_mg = ""; var sj_dg = ""; var sj_tg = "";  //--- 사주 (년월일시)간
	var sj_yj = ""; var sj_mj = ""; var sj_dj = ""; var sj_tj = "";  //--- 사주 (년월일시)지

	var sstit = ""; var ggsgg = new Array; var jjsjj = new Array; var gjsgj = new Array;
	var ganf1 = ""; var ganf2 = ""; var ganf3 = ""; var ganf4 = ""; var nfo_tugan = ""; var nfo_chng = "";
	var isol_y = ""; var isol_m = ""; var isol_d = ""; var isol_t = ""; var ohtx = "";
	var dgss_titl1 = ""; var dgss_titl2 = ""; var dgss_titl3 = ""; var dgss_titl4 = "";  //--- (일간기준) 십성이름
	var dgss_titl6 = ""; var dgss_titl7 = ""; var dgss_titl8 = ""; var gs_titl = ""; var js_titl = "";
	var aa = ""; var bb = ""; var name = ""; var exp = "";
	
//========= 간지 배경색 =========
function chg_bgcolor(a,b,c) {
	$(a).css("background","linear-gradient(143deg," + b + ", 45%," + c + " 55%)");
}

//========= 음양 판별 함수 ========
function chkOdd(num) { return (num % 2)? "양":"음"; }

//========= 화면 지우기 ========
$( function() {
	$( 'button#clear1' ).click( function() {
		$( 'input#sj' ).val('');
		$('#output').empty();
		$('#output2').empty();
		$('.sj').empty();
		$('.sja').empty();
		$('.sjb').empty();
		$('.sjo').empty();
		chg_bgcolor('.sj','#fff');
	} );
} );


//====== 배열에서 subj 를 가져오는 함수 ====== 부분배열 가져오기
function isFind(element)  {
	if(element[0] === subj)  {
		return true;
	};
};

//====== 십성배열에서 subj (지지) 를 가져오는 함수 ====== 부분배열 가져오기
function isFindj(element)  {
	if (element[1] === subj) {
		return true;
	};
};

//=========== 사주 입력시 실행되는 main 함수 ===========
$( function() {
	$( 'button#submit1' ).click( function() {
		//------------------ 변수값 clear RESET start -------------------
		sj_yg = ""; sj_mg = ""; sj_dg = ""; sj_tg = "";  //--- 사주 (년월일시)간
		sj_yj = ""; sj_mj = ""; sj_dj = ""; sj_tj = "";  //--- 사주 (년월일시)지
		dgss_titl1 = ""; dgss_titl2 = ""; dgss_titl3 = ""; dgss_titl4 = "";  //--- (일간기준) 십성이름
		dgss_titl6 = ""; dgss_titl7 = ""; dgss_titl8 = ""; gs_titl = ""; js_titl = "";
		nfo_tugan = ""; ohtx = ""; nfo_chng = "";
		isol_y = ""; isol_m = ""; isol_d = ""; isol_t = "";
		
		$('#output').empty();
		$('#output2').empty();
		$('.sj').empty();
		$('.sja').empty();
		$('.sjb').empty();
		$('.sjo').empty();
		chg_bgcolor('.sj','#fff');
		
		saju = document.getElementById('sj').value;
		subj = saju.substr(0,1); temp = gan.filter(isFindj); sj_yg = temp[0][0];
		subj = saju.substr(1,1); temp = jiji.filter(isFindj); sj_yj = temp[0][0];
		subj = saju.substr(2,1); temp = gan.filter(isFindj); sj_mg = temp[0][0];
		subj = saju.substr(3,1); temp = jiji.filter(isFindj); sj_mj = temp[0][0];
		subj = saju.substr(4,1); temp = gan.filter(isFindj); sj_dg = temp[0][0];
		subj = saju.substr(5,1); temp = jiji.filter(isFindj); sj_dj = temp[0][0];
		subj = saju.substr(6,1); temp = gan.filter(isFindj); sj_tg = temp[0][0];
		subj = saju.substr(7,1); temp = jiji.filter(isFindj); sj_tj = temp[0][0];

		mktabl();
		fill_saju();
  		ganji_root();
  		tugan();
  		rootgchk();
  		mpohcnt();
   		chnghab("천간충",4,sj_ganji,"_충");
   		chnghab("천간극",6,sj_ganji,"_극");
   		chnghab("지지충",6,sj_ganji,"_충");
    		chnghab("천간합",5,sj_ganji,"_합");
    		chnghab("지지육합",6,sj_ganji,"6합");
     		chnghab("지지삼합",4,sj_ganji,"3합");
    		chnghab("지지방합",4,sj_ganji,"b합");
     		chnghab("지지암합",5,sj_ganji,"s합");
   		chnghab("간지암합",4,sj_ganji,"x합");
		dgjmcharac();
	});
});

function fill_saju(){
	for (i=1;i<5 ; i++){
		m = i * 2 -1;
		n = i * 2;
		document.getElementById("sj" + m).innerText +=  ggsgg[i][0];
		document.getElementById("sjg" + m).innerText +=   ggsgg[i][4].substr(1,2);
//		chg_bgcolor("#sj" + m,ggsgg[i][5]); ohtx += ggsgg[i][4].substr(1,2);
		chg_bgcolor("#sj" + m,ggsgg[i][5],ggsgg[i][5]); ohtx += ggsgg[i][4].substr(1,2);
		document.getElementById("sj" + n).innerText +=  jjsjj[i][0];
		document.getElementById("sjg" + n).innerText +=  jjsjj[i][4].substr(1,2);
//		chg_bgcolor("#sj" + n,jjsjj[i][5]); ohtx += jjsjj[i][4].substr(1,2);
		chg_bgcolor("#sj" + n,jjsjj[i][5],jjsjj[i][5]); ohtx += jjsjj[i][4].substr(1,2);
		
		//--- 지장간 기록 ---
		find_ggss(jjsjj[i][6].substr(0,1),"sj" + n + "b",jjsjj[i][6],4)
		if (jjsjj[i][7] == ""){
			document.getElementById("sj" + n + "b").innerText += " \n";
		}else{
			find_ggss(jjsjj[i][7].substr(0,1),"sj" + n + "b",jjsjj[i][7],4)
		};
 		find_ggss(jjsjj[i][8].substr(0,1),"sj" + n + "b",jjsjj[i][8],4)
	}
	find_ggss(sj_yg,"sj1a","",4); dgss_titl1 = gs_titl; 
	find_ggss(sj_mg,"sj3a","",4); dgss_titl3 = gs_titl;
	document.getElementById("sj5a").innerText += "일간(나)\n";
	find_ggss(sj_tg,"sj7a","",4); dgss_titl7 = gs_titl;
	find_gjss(sj_yj,"sj2a",4); dgss_titl2 = js_titl;
	find_gjss(sj_mj,"sj4a",4); dgss_titl4 = js_titl;
	find_gjss(sj_dj,"sj6a",4); dgss_titl6 = js_titl;
	find_gjss(sj_tj,"sj8a",4); dgss_titl8 = js_titl;
};

function mktabl(){
		//==== 천간(년,월,일,시)배열 만들기 ====
		sstit = gan.slice(0, 1);  //---천간배열 이름 (첫째줄) 가져오기
		subj = sj_yg; ygsgg = gan.filter(isFind);  //---천간(년간)
		subj = sj_mg; mgsgg = gan.filter(isFind);  //---천간(월간)
		subj = sj_dg; dgsgg = gan.filter(isFind);  //---천간(일간)
		subj = sj_tg; tgsgg = gan.filter(isFind);  //---천간(시간)

		ggsgg.unshift(tgsgg[0]);  //---천간배열(시간) 추가
		ggsgg.unshift(dgsgg[0]);  //---천간배열(일간) 추가
		ggsgg.unshift(mgsgg[0]);  //---천간배열(월간) 추가
		ggsgg.unshift(ygsgg[0]);  //---천간배열(년간) 추가
		ggsgg.unshift(sstit[0]);  //---천간배열 + 이름 추가
		//------ 만들어진 천간배열 ------
		/*	0: (6) ["천간", "천간h", "오행", "음양", "이름", "색"]
			1: (6) ["갑", "甲", "목", "양", "갑양목", "#3c3"]
			2: (6) ["을", "乙", "목", "음", "을음목", "#3c3"]
			3: (6) ["경", "庚", "금", "양", "경양금", "#fff"]
			4: (6) ["병", "丙", "화", "양", "병양화", "#f00"]	*/

		//==== 지지(년,월,일,시)배열 만들기 ====
		sstit = jiji.slice(0, 1);  //---지지배열 이름 (첫째줄) 가져오기
		subj = sj_yj; yjsjj = jiji.filter(isFind);  //---지지(년지)
		subj = sj_mj; mjsjj = jiji.filter(isFind);  //---지지(월지)
		subj = sj_dj; djsjj = jiji.filter(isFind);  //---지지(일지)
		subj = sj_tj; tjsjj = jiji.filter(isFind);  //---지지(시지)

		jjsjj.unshift(tjsjj[0]);  //---지지배열(시지) 추가
		jjsjj.unshift(djsjj[0]);  //---지지배열(일지) 추가
		jjsjj.unshift(mjsjj[0]);  //---지지배열(월지) 추가
		jjsjj.unshift(yjsjj[0]);  //---지지배열(년지) 추가
		jjsjj.unshift(sstit[0]);  //---지지배열 + 이름 추가
		//------ 만들어진 지지배열 ------
		/*	0: (16) ["지지", "지지h", "오행", "음양", "이름", "색", "여기", "중기", "정기", "충", "육합", "육화", "삼합", "삼화", "방합", "방화"]
			1: (16) ["오", "午", "화", "음", "오음화", "#f00", "병10", "기9", "정11", "자", "미", "화", "인술", "화", "사미", "화"]
			2: (16) ["해", "亥", "수", "양", "해양수", "#999", "무7", "갑7", "임16", "사", "인", "목", "묘미", "목", "자축", "수"]
			3: (16) ["오", "午", "화", "음", "오음화", "#f00", "병10", "기9", "정11", "자", "미", "화", "인술", "화", "사미", "화"]
			4: (16) ["자", "子", "수", "음", "자음수", "#999", "임10", "", "계20", "오", "축", "토", "신진", "수", "해축", "수"]	*/

		//==== 십성 간(년,월,일,시) 지(년,월,일,시) 배열 만들기 ====
		sstit = sibsungX1.slice(0, 2);  //---십성배열 이름 (천간:첫째줄, 지지:둘째줄) 가져오기
		subj = sj_yg; ygssg = sibsungX1.filter(isFind);  //---십성(년간)
		subj = sj_mg; mgssg = sibsungX1.filter(isFind);  //---십성(월간)
		subj = sj_dg; dgssg = sibsungX1.filter(isFind);  //---십성(일간)
		subj = sj_tg; tgssg = sibsungX1.filter(isFind);  //---십성(시간)
		subj = sj_yj; yjssj = sibsungX1.filter(isFindj);  //---십성(년지)
		subj = sj_mj; mjssj = sibsungX1.filter(isFindj);  //---십성(월지)
		subj = sj_dj; djssj = sibsungX1.filter(isFindj);  //---십성(일지)
		subj = sj_tj; tjssj = sibsungX1.filter(isFindj);  //---십성(시지)

		gjsgj.unshift(tjssj[0]);  //---십성배열(시지) 추가
		gjsgj.unshift(djssj[0]);  //---십성배열(일지) 추가
		gjsgj.unshift(mjssj[0]);  //---십성배열(월지) 추가
		gjsgj.unshift(yjssj[0]);  //---십성배열(년지) 추가
		gjsgj.unshift(tgssg[0]);  //---십성배열(시간) 추가
		gjsgj.unshift(dgssg[0]);  //---십성배열(일간) 추가
		gjsgj.unshift(mgssg[0]);  //---십성배열(월간) 추가
		gjsgj.unshift(ygssg[0]);  //---십성배열(년간) 추가
		gjsgj.unshift(sstit[1]);  //---십성배열 + 지지이름 추가
		gjsgj.unshift(sstit[0]);  //---십성배열 + 천간이름 추가
		//------ 만들어진 십성배열 ------
		/*	0: (13) ["xx", "xx", "gn", "갑", "을", "병", "정", "무", "기", "경", "신", "임", "계"]
			1: (13) ["gn", "jj", "oh", "인", "묘", "사", "오", "진술", "축미", "신", "유", "해", "자"]
			2: (13) ["갑", "인", "양목", "비견", "겁재", "식신", "상관", "편재", "정재", "편관", "정관", "편인", "정인"]
			3: (13) ["을", "묘", "음목", "겁재", "비견", "상관", "식신", "정재", "편재", "정관", "편관", "정인", "편인"]
			4: (13) ["경", "신", "양금", "편재", "정재", "편관", "정관", "편인", "정인", "비견", "겁재", "식신", "상관"]
			5: (13) ["병", "사", "양화", "편인", "정인", "비견", "겁재", "식신", "상관", "편재", "정재", "편관", "정관"]
			6: (13) ["정", "오", "음화", "정인", "편인", "겁재", "비견", "상관", "식신", "정재", "편재", "정관", "편관"]
			7: (13) ["임", "해", "양수", "식신", "상관", "편재", "정재", "편관", "정관", "편인", "정인", "비견", "겁재"]
			8: (13) ["정", "오", "음화", "정인", "편인", "겁재", "비견", "상관", "식신", "정재", "편재", "정관", "편관"]
			9: (13) ["계", "자", "음수", "상관", "식신", "정재", "편재", "정관", "편관", "정인", "편인", "겁재", "비견"]	*/
};

function find_ggss(gan,css,jjg,no){
	gs_titl = "";
	idx = gjsgj[0].lastIndexOf(gan);
	gs_titl = gjsgj[no][idx];  //--- (천간)십성 이름
	if (css != ""){document.getElementById(css).innerText += jjg + " " + gs_titl + "\n";};
};

function find_gjss(ji,css,no){
	js_titl = "";
	if (ji == "辰" || ji == "戌"){idx = gjsgj[1].lastIndexOf("辰戌");
	}else{if (ji == "丑" || ji == "未"){idx = gjsgj[1].lastIndexOf("丑未");
		}else{idx = gjsgj[1].lastIndexOf(ji);};};
	js_titl = gjsgj[no][idx];  //--- (지지)십성 이름
	if (css != ""){document.getElementById(css).innerText += js_titl + "\n";};
};

//---- 통근체크 ----
function ganji_root(){
	//------ 모든 천간의 통근 확인 -----------
	document.getElementById("output2").innerText += "(위치 가중치: 10 7 4 1 월지13 일지12 기본10) \n";
	root_point("년간",gjsgj[2],"비견","겁재","편인","정인","output2");
	root_point("월간",gjsgj[3],"비견","겁재","편인","정인","output2");
	root_point("일간",gjsgj[4],"비견","겁재","편인","정인","output2");
	root_point("시간",gjsgj[5],"비견","겁재","편인","정인","output2");
	document.getElementById("output2").innerText += "\n";
};

//========== 천간의 통근을 확인하는 함수 ==========
function root_point(a,b,c,d,e,f,g) {
	tit = ""; cfm = ""; eff1 = 0; eff2 = 0; eff3 = 0; eff4 = 0; eff0 = 0;
	efft = 0; isol = "";
		idx = b.lastIndexOf(c); tit += gjsgj[0][idx];
		idx = b.lastIndexOf(d); tit += gjsgj[0][idx];
		idx = b.lastIndexOf(e); tit += gjsgj[0][idx];
		idx = b.lastIndexOf(f); tit += gjsgj[0][idx];		
	for (i=1;i<5 ; i++){
		if (tit.includes(jjsjj[i][8].substr(0,1))==true){document.getElementById(g).innerText += i + ".... 지장간 " + jjsjj[i][8] + "\n"; cfm += "kj"; eval('eff' + i + ' += Number(jjsjj[i][8].substr(1,2))');};
		if (jjsjj[i][7] != "" && tit.includes(jjsjj[i][7].substr(0,1))==true){document.getElementById(g).innerText += i + ".... 지장간b " + jjsjj[i][7] + "\n"; cfm += "kj"; eval('eff' + i + ' += Number(jjsjj[i][7].substr(1,2))');};
		if (tit.includes(jjsjj[i][6].substr(0,1))==true){document.getElementById(g).innerText += i + ".... 지장간a " + jjsjj[i][6] + "\n"; cfm += "kj"; eval('eff' + i + ' += Number(jjsjj[i][6].substr(1,2))');};
	};
	if (a == "년간"){eff0 = (eff1 * 100) + (eff2 *13 * 7) + (eff3 * 12 * 4) + (eff4 * 10);};
	if (a == "월간"){eff0 = (eff2 * 130) + (eff3 *12 * 7) + (eff4 * 40) + (eff1 * 70);};
	if (a == "일간"){eff0 = (eff3 * 120) + (eff2 *13 * 7) + (eff4 * 70) + (eff1 * 40);};
	if (a == "시간"){eff0 = (eff4 * 100) + (eff3 *12 * 7) + (eff2 * 13 * 4) + (eff1 * 10);};
	efft = parseInt(eff0 / 30);
	if (efft > 119){ ganf = "극강";
	}else{if (efft > 89){ ganf = "강";
		}else{if (efft > 59){ ganf = "중";
			}else{if (efft > 29){ ganf = "약";
				}else{ganf = "극약";}}};};
	if (a == "년간"){ 
		ganf1 = ganf; 
		if (ganf1 != "극약" || tit.includes(sj_mg)){
			isol_y = "";
		}else{isol_y = "고립"; isol = "고립";};
	};		
	if (a == "월간"){ 
		ganf2 = ganf;
		if (ganf2 != "극약" || tit.includes(sj_dg) || tit.includes(sj_yg)){
			isol_m = "";
		}else{isol_m = "고립"; isol = "고립";};
	};		
	if (a == "일간"){ 
		ganf3 = ganf 
		if (ganf3 != "극약" || tit.includes(sj_mg) || tit.includes(sj_tg)){
			isol_d = "";
		}else{isol_d = "고립"; isol = "고립";};
	};		
	if (a == "시간"){ 
		ganf4 = ganf 
		if (ganf4 != "극약" || tit.includes(sj_dg)){
			isol_t = "";
		}else{isol_t = "고립"; isol = "고립";};
	};		
	document.getElementById("output2").innerText += ".............................." + a + " " + b[0] + " 통근 " + ganf + isol + " ..... " + String(efft) + "%\n";
};	
	
//========== 지지의 투간을 확인하는 함수 ==========
function tugan(){
	sj_gan = sj_yg + sj_mg + sj_dg + sj_tg; 
	sj_ji = sj_yj + sj_mj + sj_dj + sj_tj; 
	sj_ganji = sj_yg + sj_yj + sj_mg + sj_mj + sj_dg + sj_dj + sj_tg + sj_tj;
	jjg = ""; eff0 = 0; pos = "";idx = 0; n = 0; ttx = "";

	for (i=1; i<5; i++){
		for (j=0; j<3; j++){
			jjg = jjsjj[i][j+6].substr(0,1);  //--- 지장간
			if (jjg != ""){
				eff = Number(jjsjj[i][j+6].substr(1,2));  //---지장간 비율
				eff0 = 0; pos = "";
				if (sj_gan.includes(jjg)){
					n = 0;
					while (true){
						idx = sj_gan.indexOf(jjg,n)  //--- 투간된 위치
						if(idx == -1){break;};		
						pos += String(idx+1);
						eff0 += parseInt(eff/30 *(100-Math.abs(idx+1-i)*30));
						n = idx + 1;
					};
					if (i == 1){ttx = "년지";
					}else{	if (i == 2){ttx = "월지"; idx = gjsgj[0].lastIndexOf(jjg); nfo_tugan += "월지투간==> " + gjsgj[4][idx] + "格 "+ jjg + "..용신\n\n";
						}else{	if (i == 3){ttx = "일지";
							}else{	if (i == 4){ttx = "시지";}}}};
					document.getElementById("output2").innerText += String(i) + ".... 지장간 " + jjg + eff + "..........." + ttx +" .... " + pos + " 투간... " + eff0 + "%\n";
				};	
			};
		};
	};
};
	
//===== 오행갯수를 변수에 저장하는 함수 =====	
function findText(sar,wrd,mm){
	eval('cn = sar.match(/' + wrd + '/g)');
	if(cn != null) {
		eval(mm + "= cn.length");
	}else{eval(mm + "= 0")};
};
	
//========== 오행의 갯수 check 하는 함수 ==========
function mpohcnt(){
	var sar = ohtx;  //--- 음양오행
	document.getElementById("output2").innerText += "오행...양...음\n";
	for (i=1; i<6; i++){
		wrd = "양" + ohang[i][0]; mm = "sp"; findText(sar,wrd,mm); eval('sp' + i + '= sp;');
		wrd = "음" + ohang[i][0]; mm = "sm"; findText(sar,wrd,mm); eval('sm' + i + '= sm;');
		document.getElementById("output2").innerText += "..." + ohang[i][1] + "......" + String(sp) + "......" + String(sm) + "\n";
	};
	document.getElementById("output2").innerText += "\n";
};
	
//=========== 일간의 통근 상황 확인===========
function rootgchk(){
	pointr = "";
	document.getElementById("output2").innerText += "\n";
	dgroot(dgss_titl6,1);  //----- 일지 = 인성/비겁 여부 -----
	dgroot(dgss_titl4,2);  //----- 월지 = 인성/비겁 여부 -----
	pwrcnt();  //----- 일간의 세력상태 확인 -----
	
	pn = pointr.match(/Y/g);
	pn1 = pointr.match(/N/g);
	if(pn != null) {
		if(pn.length === 3){
			document.getElementById("output2").innerText += "극신강 사주 ..." + pointr + "\n";
		}else{
			if(pn.length === 2){
				document.getElementById("output2").innerText += "신강 사주 ..." + pointr + "\n";
			}else{
				if(pn.length === 1){
					document.getElementById("output2").innerText += "신약 사주 ..." + pointr + "\n";}}};
	}else{document.getElementById("output2").innerText += "극신약 사주 ..." + pointr + "\n";};
	 find_gjss(sj_mj,"",4); document.getElementById("output2").innerText += "사주격국 (기본) " + js_titl + "格 " + nfo_tugan;
};	
	
//========= 일간의 통근 check 하는 함수 ========
function dgroot(pos,a){
	pass = ""; fail = "";
	if (pos === "정인" || pos === "편인" || pos === "비견" || pos === "겁재"){ 
		if (a === 1){ pointr = pointr + "득지Y"; pass = "득지\n";
		}else{if (a === 2){ pointr = pointr + "득령Y"; pass = "득령\n";}else{pass = pos + " 통근\n";}};
		document.getElementById("output2").innerText += "일간 " + pass;
	}else{
		if (a === 1){ pointr = pointr + "실지N"; fail = "실지\n";
		}else{if (a === 2){ pointr = pointr + "실령N"; fail = "실령\n";}else{ fail = " ";}};
		document.getElementById("output2").innerText += fail;};
};
	
//========= 일간의 세력 check 하는 함수 =========
function pwrcnt(){
	sstext = dgss_titl1 + dgss_titl2 + dgss_titl3 + dgss_titl4 + dgss_titl6 + dgss_titl7 + dgss_titl8;  //--- 십성
	wrd = "비견"; mm = "r1"; findText(sstext,wrd,mm); 
	wrd = "겁재"; mm = "r2"; findText(sstext,wrd,mm);
	wrd = "편인"; mm = "r3"; findText(sstext,wrd,mm);
	wrd = "정인"; mm = "r4"; findText(sstext,wrd,mm);
	r0 = r1 + r2 + r3 + r4;
	if (r0 > 3){
		pointr = pointr + "득세Y";
		document.getElementById("output2").innerText += "일간 득세 " + String(r0) + " / " + String(7-r0) + "\n\n";
	}else{
		pointr = pointr + "실세N";
		document.getElementById("output2").innerText += "일간 실세 " + String(r0) + " / " + String(7-r0) + "\n\n";};
};
	
//========== 문자 검색 함수 ==========
function txtSearch(str, searchvalue){
	let pos = 0; fndList = ""; outpt = "";
	while (true) {let foundPos = str.indexOf(searchvalue, pos);
		if (foundPos == -1) {break;
		}else{
			if (foundPos==null){fndList = ""; searchvalue = "";
			}else{fndList += String(foundPos); pos = foundPos + 1; }};
	};
	if (fndList){aa += searchvalue; bb += fndList;};
};

//========== 충/합 ==========
	//---   chnghab("천간충",4,sj_ganji,"_충");
function chnghab(name,qt,str,exp){
	cv_ghab = ["천간합","02","24","46"]	
	cv_gjxh = ["간지암합","01","03","21","23","25","43","45","47","65","67"]
	cv_j6sh = ["육합암합","13","35","57"]
	cv_j3bh = ["삼합방합","135","357"]
	subj = name; pon = "";
	chab = ganji_habchung.filter(isFind);  //===천간충/극
	var outpt = ""; var fndList = "";
	for (i = 1; i < qt + 1; i++){texstr = chab[0][i]; n=0; aa=""; bb="";
		for (k = 0; k < texstr.length; k++){
			aa1 = texstr.substr(k,1);
			txtSearch(str,aa1);
			if (fndList === "-1" || fndList === null){aa1 = "";}else{n += 1;};
		};
		//--- 출력내용 작성 ---
		ch_titl0 = ""; ch_titl1 = ""; adt1 = ""; adt2 = ""; adt3 = "";
		if (aa.length === texstr.length){
			if (name.substr(2,1) === "충"){nfo_chng += aa;};  //--- 충 인 경우
			if (name.substr(2,1) === "충" || name.substr(2,1) === "극"){  //--- 충 또는 극 인 경우
				ch_titl0 = aa + exp + "\n"; ch_titl1 =  aa + exp + "\n";
				for (j=0; j<bb.length; j++){
					pon = Number(bb.substr(j,1)) + 1;
					loc = "sj" + String(pon) + "a";
					document.getElementById(loc).innerText += ch_titl0;
				};
				document.getElementById("output2").innerText += ch_titl1; 
				if (name === "지지충"){
					subj = aa;
					c_sign = sig_chung.filter(isFind);  //===천간충/극
					ch_titl2 = aa + exp + " ==> " + c_sign[0][2] + "\n" + c_sign[0][3] + "\n" + c_sign[0][4] + "\n\n" + c_sign[0][5] + "\n" + c_sign[0][6] + "\n" + c_sign[0][7] + "\n" + c_sign[0][8] + "\n" + c_sign[0][9] + "\n\n";
					document.getElementById("output").innerText += ch_titl2; 
				};
			}else{  //--- 합 인 경우
				cv = "";
				if (name === "천간합"){ cv = cv_ghab; };				
				if (name === "간지암합"){ cv = cv_gjxh;};
				if (name === "지지육합" || name === "지지암합"){ cv = cv_j6sh;};
				if (name === "지지삼합" || name === "지지방합"){ cv = cv_j3bh;};

				for (m = 1; m < cv.length; m++){ ckstr = cv[m];
					ck1 = ckstr.substr(0,1); ck2 = ckstr.substr(1,1); ck3 = ckstr.substr(2,1);
					if (name === "지지삼합" || name === "지지방합"){  //--- 3글자 합 인 경우
						if (nfo_chng.includes(aa.substr(0,1)) || nfo_chng.includes(aa.substr(1,1)) || nfo_chng.includes(aa.substr(2,1))){
							adt1 = "("; adt2 = ")"; adt3 = "...불성립";
						};
						if (bb.includes(ck1) && bb.includes(ck2) && bb.includes(ck3)){
							ch_titl0 = adt1 + aa + exp + adt2 + "\n"; ch_titl1 =  adt1 + aa + exp + adt2 + adt3 + "\n";
							loc = "sj" + String(Number(ck1) + 1) + "a"; document.getElementById(loc).innerText += ch_titl0;
							loc = "sj" + String(Number(ck2) + 1) + "a"; document.getElementById(loc).innerText += ch_titl0;
							loc = "sj" + String(Number(ck3) + 1) + "a"; document.getElementById(loc).innerText += ch_titl0;
							document.getElementById("output2").innerText += ch_titl1; 
						};
				        }else{		  //--- 2글자 합 인 경우
						if (nfo_chng.includes(aa.substr(0,1)) || nfo_chng.includes(aa.substr(1,1))){
							adt1 = "("; adt2 = ")"; adt3 = "...불성립";
						};
						if (bb.includes(ck1) && bb.includes(ck2)){
							if (name === "천간합"){
								if (ck1 === "4" || ck2 === "4"){
									if (sj_dg === "己" || sj_dg === "庚"){adt1 = ""; adt2 = ""; adt3 = "";
									}else{adt1 = "("; adt2 = ")"; adt3 = "...불성립";};
								};
								subj = aa; hwa = habhwa.filter(isFind); 
								if (isol_y === "고립" && aa.includes(sj_yg)){chg_bgcolor("#sj1",hwa[0][3],hwa[0][3]);};
								if (isol_m === "고립" && aa.includes(sj_mg)){chg_bgcolor("#sj3",hwa[0][3],hwa[0][3]);};
							};
							ch_titl0 = adt1 + aa + exp + adt2 + "\n"; ch_titl1 =  adt1 + aa + exp + adt2 + adt3 + "\n";
							loc = "sj" + String(Number(ck1) + 1) + "a"; document.getElementById(loc).innerText += ch_titl0;
							loc = "sj" + String(Number(ck2) + 1) + "a"; document.getElementById(loc).innerText += ch_titl0;
							document.getElementById("output2").innerText += ch_titl1; 
						};
				        };
				};
		        };
		};
       };
};
	
//=============== 성격 display ==============
function dgjmcharac(){
	//--------- 일간에 따른 성격 display ---------
	subj = sj_dg;
	dgcharac = dgan_charac.filter(isFind);  //---일간성격
	dgtext = "\n<성격의 성향> 일간 " + dgcharac[0][1] + dgcharac[0][2] + " ==> " + dgcharac[0][3] + "\n" + dgcharac[0][4] + "\n" + dgcharac[0][5] + "\n" + dgcharac[0][6] + "\n" + dgcharac[0][7] + "\n" + dgcharac[0][8] + "\n\n";
//	dgtext1 = "<성격> 일간 " + dgcharac[0][1] + dgcharac[0][2] + " ==> " + dgcharac[0][9] + "\n" + dgcharac[0][10] + "--표면심리--" + dgcharac[0][11] + "\n" + dgcharac[0][12] + "--내면심리--" + dgcharac[0][13] + "\n" + "\n";
	document.getElementById("output").innerText += dgtext;
//	document.getElementById("output2").innerText += dgtext1;
	//--------- 일주에 따른 성격 display ---------
	subj = sj_dg + sj_dj;
	dgjcharac = dgabja60_charac.filter(isFind);  //---일주성격
	dgjtext = "<성격> 일주 " + dgjcharac[0][1] + " ==> "  + dgjcharac[0][2] + "\n" + dgjcharac[0][3] + "\n" + dgjcharac[0][4] + "\n" + dgjcharac[0][5] + "\n" + dgjcharac[0][6] + "\n" + dgjcharac[0][7] + "\n\n";
	document.getElementById("output").innerText += dgjtext;
	//--------- 월지(십성)에 따른 성격 display ---------
	subj = dgss_titl4;
	mjcharac = mjdjss_charac.filter(isFind);  //---월지성격
	mjtext = "<환경적 영향> 월지십성 " + mjcharac[0][0] + " " + mjcharac[0][1] + "\n" + mjcharac[0][2] + "\n" + mjcharac[0][3] + "\n" + mjcharac[0][4] + "\n" + mjcharac[0][5] + "\n\n";
	document.getElementById("output").innerText += mjtext;
	//--------- 일지(십성)에 따른 성격 display ---------
	subj = dgss_titl6;
	djcharac = mjdjss_charac.filter(isFind);  //---일지성격
	djtext = "<배우자 관련> 일지십성 " + djcharac[0][0] + " " + djcharac[0][1] + "\n" + djcharac[0][6] + "\n" + djcharac[0][7] + "\n\n";
	document.getElementById("output").innerText += djtext;
};
	

  </script>

    </body>
</html>
