<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=0.5">
  <link rel="shortcut icon" href="#" type="image/x-icon">
  <link rel="icon" href="#" type="image/x-icon">
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />        
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css" />
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script> 
  <script src="http://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script src="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js"></script>      

  <style type="text/css">

	input,button{font-size:14px; text-align:center; font-weight:bold;}
	input:focus,#ctg:focus{outline:none;}
	#fileUpload,#upload,#skds,#bctg{margin:10px;}

	*{margin:0;padding:0px;list-style:none;text-decoration:none;}
	body{font-size:100%;}
	.container{width:100%; min-height: 950px;}
	.canvas {
		background: url(./bga.jpg) fixed;
		display:grid; 
		grid-template-columns: repeat(15,30px);
		padding: 20px;
		background-size:cover; 
		grid-gap: 0px;
		text-align:center;
		}
	.ifo {margin: 15px; font-size: 1.2em; height: 25px;}
	#nm {font-size: 1.0em; font-weight: bold; width:70px;}
	#sj {font-size: 1.0em; font-weight:bold;width:170px;}
	.sjt {grid-column: 1/span 3;grid-row: 2/span 5; color: #000; font-weight: bold;border:1px solid black;}
	.sjo,.sjot,.sja,.sjat,.sjb,.sjbt {grid-column: span 3;grid-row: span 1; color: #000; font-weight: bold;border:1px solid black;min-height:30px;}
	.sja { font-size: 0.9em;}
	.sj {grid-column: span 3;grid-row: span 1; color: #000; font-weight: bold;border:1px solid black;height:60px;font-size:3.0em; font-family:"한양해서";}
	#output { min-height: 790px; color: #000; padding:10px;border:1px solid black;text-align:left; font-size: 0.8em;max-width:1000px;}
	#output2 { display: none; float: left; min-height: 400px; color: #000; padding:10px;border:1px solid black;text-align:left; font-size: 0.8em;max-width:500px;}
	#submit1 {padding: 0 10px; font-weight: bold;}
	#clear1 {padding: 0 5px;}
	@media screen and (min-width: 950px) {.canvas {float: left;} #output {float: right;min-width:800px;} #output2 {display: flex;}}

  </style>

 </head>
 <body>
<div id="dvCSV">
</div>    

<!-- 메인메뉴 mmenu part -->
<div class="container">

<p class="ifo"> 사주: <input type="text" id="sj" maxlength="8"> &nbsp; &nbsp;<button id="clear1">지우기</button> &nbsp; &nbsp;<button id="submit1">제 출</button></p> 

<hr/>
	<div class="canvas">

		<div class="sjat">십성(간)</div>
		<div class="sja" id="sj7a"></div>
		<div class="sja" id="sj5a"></div>
		<div class="sja" id="sj3a"></div>
		<div class="sja" id="sj1a"></div>
		<div class="sjt">사주</div>
		<div class="sjot">시</div>
		<div class="sjot">일</div>
		<div class="sjot">월</div>
		<div class="sjot">년</div>
		<div class="sj" id="sj7"></div>
		<div class="sj" id="sj5"></div>
		<div class="sj" id="sj3"></div>
		<div class="sj" id="sj1"></div>
		<div class="sjo" id="sjg7"></div>
		<div class="sjo" id="sjg5"></div>
		<div class="sjo" id="sjg3"></div>
		<div class="sjo" id="sjg1"></div>
		<div class="sj" id="sj8"></div>
		<div class="sj" id="sj6"></div>
		<div class="sj" id="sj4"></div>
		<div class="sj" id="sj2"></div>
		<div class="sjo" id="sjg8"></div>
		<div class="sjo" id="sjg6"></div>
		<div class="sjo" id="sjg4"></div>
		<div class="sjo" id="sjg2"></div>
		<div class="sjat">십성(지)</div>
		<div class="sja" id="sj8a"></div>
		<div class="sja" id="sj6a"></div>
		<div class="sja" id="sj4a"></div>
		<div class="sja" id="sj2a"></div>
		<div class="sjbt">지장간</div>
		<div class="sjb" id="sj8b"></div>
		<div class="sjb" id="sj6b"></div>
		<div class="sjb" id="sj4b"></div>
		<div class="sjb" id="sj2b"></div>

	</div>
	<div id="output"></div>
	<div id="output2"></div>
</div>
	
<script type="text/javascript">

fread("gan");
fread("jiji");
fread("sibsungX1");
fread("ganji_habchung");
fread("dgan_charac");
fread("dgabja60_charac");
fread("mjdjss_charac");
	
function fread(fn){
    $(function (){
	var fileName = "./" + fn + ".csv";	// 파일 이름

	$.ajax({
		url:fileName,
		dataType:'text',
		success: function(da) {
			var textLine = '<script type="text/javascript">var ' + fn + '=[';
                        var rows = da.split('\n');
                        for (var i = 0; i < rows.length; i++) {
				if (i == 0){textLine += '['}else{textLine += ',['};
				var cells = rows[i].split(',');
                                for (var j = 0; j < cells.length; j++) {
					textLine += '"';
					textLine += cells[j].trim();;
					if (j == cells.length-1){textLine += '"'}else{textLine += '",'};
				}
				textLine += ']';
			}	
			textLine += ']';			
			$('#dvCSV').append(textLine);
		}
	});
    });
};
</script>

<script type="text/javascript">
	var saju = "";
	var sj_yg = ""; var sj_mg = ""; var sj_dg = ""; var sj_tg = "";  //--- 사주 (년월일시)간
	var sj_yj = ""; var sj_mj = ""; var sj_dj = ""; var sj_tj = "";  //--- 사주 (년월일시)지

	var sstit = ""; var ggsgg = new Array; var jjsjj = new Array; var gjsgj = new Array;

var gan = [
["천간", "천간h", "오행", "음양", "이름", "색"],
["갑", "甲", "목", "양", "갑양목", "#3c3"],
["을", "乙", "목", "음", "을음목", "#3c3"],
["병", "丙", "화", "양", "병양화", "#f00"],
["정", "丁", "화", "음", "정음화", "#f00"],
["무", "戊", "토", "양", "무양토", "#fc6"],
["기", "己", "토", "음", "기음토", "#fc6"],
["경", "庚", "금", "양", "경양금", "#fff"],
["신", "辛", "금", "음", "신음금", "#fff"],
["임", "壬", "수", "양", "임양수", "#666"],
["계", "癸", "수", "음", "계음수", "#666"] ];

var jiji = [
["지지", "지지h", "오행", "음양", "이름", "색", "여기", "중기", "정기", "충", "육합", "육화", "삼합", "삼화", "방합", "방화"],
["자", "子", "수", "음", "자음수", "#999", "임10", "", "계20", "오", "축", "토", "신진", "수", "해축", "수"],
["축", "丑", "토", "음", "축음토", "#fc6", "계9", "신3", "기18", "미", "자", "토", "사유", "금", "해자", "수"],
["인", "寅", "목", "양", "인양목", "#3c3", "무7", "병7", "갑16", "신", "해", "목", "오술", "화", "묘진", "목"],
["묘", "卯", "목", "음", "묘음목", "#3c3", "갑10", "", "을20", "유", "술", "화", "해미", "목", "인진", "목"],
["진", "辰", "토", "양", "진양토", "#fc6", "을9", "계3", "무18", "술", "유", "금", "신자", "수", "인묘", "목"],
["사", "巳", "화", "양", "사양화", "#f00", "무7", "경7", "병16", "해", "신", "수", "유축", "금", "오미", "화"],
["오", "午", "화", "음", "오음화", "#f00", "병10", "기9", "정11", "자", "미", "화", "인술", "화", "사미", "화"],
["미", "未", "토", "음", "미음토", "#fc6", "정9", "을3", "기18", "축", "오", "화", "해묘", "목", "사오", "화"],
["신", "申", "금", "양", "신양금", "#fff", "무7", "임7", "경16", "인", "사", "수", "자진", "수", "유술", "금"],
["유", "酉", "금", "음", "유음금", "#fff", "경10", "", "신20", "묘", "진", "금", "사축", "금", "신술", "금"],
["술", "戌", "토", "양", "술양토", "#fc6", "신9", "정3", "무18", "진", "묘", "화", "인오", "화", "신유", "금"],
["해", "亥", "수", "양", "해양수", "#999", "무7", "갑7", "임16", "사", "인", "목", "묘미", "목", "자축", "수"]];


var sibsungX1 = [
["xx", "xx", "gn", "갑", "을", "병", "정", "무", "기", "경", "신", "임", "계"],
["gn", "jj", "oh", "인", "묘", "사", "오", "진술", "축미", "신", "유", "해", "자"],
["갑", "인", "양목", "비견", "겁재", "식신", "상관", "편재", "정재", "편관", "정관", "편인", "정인"],
["을", "묘", "음목", "겁재", "비견", "상관", "식신", "정재", "편재", "정관", "편관", "정인", "편인"],
["병", "사", "양화", "편인", "정인", "비견", "겁재", "식신", "상관", "편재", "정재", "편관", "정관"],
["정", "오", "음화", "정인", "편인", "겁재", "비견", "상관", "식신", "정재", "편재", "정관", "편관"],
["무", "진술", "양토", "편관", "정관", "편인", "정인", "비견", "겁재", "식신", "상관", "편재", "정재"],
["기", "축미", "음토", "정관", "편관", "정인", "편인", "겁재", "비견", "상관", "식신", "정재", "편재"],
["경", "신", "양금", "편재", "정재", "편관", "정관", "편인", "정인", "비견", "겁재", "식신", "상관"],
["신", "유", "음금", "정재", "편재", "정관", "편관", "정인", "편인", "겁재", "비견", "상관", "식신"],
["임", "해", "양수", "식신", "상관", "편재", "정재", "편관", "정관", "편인", "정인", "비견", "겁재"],
["계", "자", "음수", "상관", "식신", "정재", "편재", "정관", "편관", "정인", "편인", "겁재", "비견"]];

//========= 간지 배경색 =========
function chg_bgcolor(a,b) {
	$(a).css("background-color",b);
}

//========= 음양 판별 함수 ========
function chkOdd(num) { return (num % 2)? "양":"음"; }

//========= 화면 지우기 ========
$( function() {
	$( 'button#clear1' ).click( function() {
		$( 'input#sj' ).val('');
		$('#output').empty();
		$('#output2').empty();
		$('.sj').empty();
		$('.sja').empty();
		$('.sjb').empty();
		$('.sjo').empty();
		chg_bgcolor('.sj','#fff');
	} );
} );


//====== 배열에서 subj 를 가져오는 함수 ====== 부분배열 가져오기
function isFind(element)  {
	if(element[0] === subj)  {
		return true;
	};
};

//====== 십성배열에서 subj (지지) 를 가져오는 함수 ====== 부분배열 가져오기
function isFindj(element)  {
	if (element[1] === subj) {
		return true;
	};
};


//=========== 사주 입력시 실행되는 main 함수 ===========
$( function() {
	$( 'button#submit1' ).click( function() {
		//------------------ 변수값 clear RESET start -------------------
		sj_yg = ""; sj_mg = ""; sj_dg = ""; sj_tg = "";  //--- 사주 (년월일시)간
		sj_yj = ""; sj_mj = ""; sj_dj = ""; sj_tj = "";  //--- 사주 (년월일시)지
		$('#output').empty();
		$('#output2').empty();
		$('.sj').empty();
		$('.sja').empty();
		$('.sjb').empty();
		$('.sjo').empty();
		chg_bgcolor('.sj','#fff');
		
		saju = document.getElementById('sj').value;
		sj_yg = saju.substr(0,1);
		sj_yj = saju.substr(1,1);
		sj_mg = saju.substr(2,1);
		sj_mj = saju.substr(3,1);
		sj_dg = saju.substr(4,1);
		sj_dj = saju.substr(5,1);
		sj_tg = saju.substr(6,1);
		sj_tj = saju.substr(7,1);

		mktabl();
		fill_saju();
		ganji_root();



	});
});


function fill_saju(){
	for (i=1;i<5 ; i++){
		m = i * 2 -1;
		n = i * 2;
		document.getElementById("sj" + m).innerText +=  ggsgg[i][1];
		document.getElementById("sjg" + m).innerText +=   ggsgg[i][4].substr(1,2);
		chg_bgcolor("#sj" + m,ggsgg[i][5]);
		document.getElementById("sj" + n).innerText +=  jjsjj[i][1];
		document.getElementById("sjg" + n).innerText +=  jjsjj[i][4].substr(1,2);
		chg_bgcolor("#sj" + n,jjsjj[i][5]);

		//--- 지장간 기록 ---
		find_ggss(jjsjj[i][6].substr(0,1),"sj" + n + "b",jjsjj[i][6],4)
		if (jjsjj[i][7] == ""){
			document.getElementById("sj" + n + "b").innerText += " \n";
		}else{
			find_ggss(jjsjj[i][7].substr(0,1),"sj" + n + "b",jjsjj[i][7],4)
		};
		find_ggss(jjsjj[i][8].substr(0,1),"sj" + n + "b",jjsjj[i][8],4)
	}
	find_ggss(sj_yg,"sj1a","",4)
	find_ggss(sj_mg,"sj3a","",4)
	document.getElementById("sj5a").innerText += "일간(나)";
	find_ggss(sj_tg,"sj7a","",4)
	find_gjss(sj_yj,"sj2a",4)
	find_gjss(sj_mj,"sj4a",4)
	find_gjss(sj_dj,"sj6a",4)
	find_gjss(sj_tj,"sj8a",4)
};

function mktabl(){
		//==== 천간(년,월,일,시)배열 만들기 ====
		sstit = gan.slice(0, 1);  //---천간배열 이름 (첫째줄) 가져오기
		subj = sj_yg; ygsgg = gan.filter(isFind);  //---천간(년간)
		subj = sj_mg; mgsgg = gan.filter(isFind);  //---천간(월간)
		subj = sj_dg; dgsgg = gan.filter(isFind);  //---천간(일간)
		subj = sj_tg; tgsgg = gan.filter(isFind);  //---천간(시간)

		ggsgg.unshift(tgsgg[0]);  //---천간배열(시간) 추가
		ggsgg.unshift(dgsgg[0]);  //---천간배열(일간) 추가
		ggsgg.unshift(mgsgg[0]);  //---천간배열(월간) 추가
		ggsgg.unshift(ygsgg[0]);  //---천간배열(년간) 추가
		ggsgg.unshift(sstit[0]);  //---천간배열 + 이름 추가
		//------ 만들어진 천간배열 ------
		/*	0: (6) ["천간", "천간h", "오행", "음양", "이름", "색"]
			1: (6) ["갑", "甲", "목", "양", "갑양목", "#3c3"]
			2: (6) ["을", "乙", "목", "음", "을음목", "#3c3"]
			3: (6) ["경", "庚", "금", "양", "경양금", "#fff"]
			4: (6) ["병", "丙", "화", "양", "병양화", "#f00"]	*/

		//==== 지지(년,월,일,시)배열 만들기 ====
		sstit = jiji.slice(0, 1);  //---지지배열 이름 (첫째줄) 가져오기
		subj = sj_yj; yjsjj = jiji.filter(isFind);  //---지지(년지)
		subj = sj_mj; mjsjj = jiji.filter(isFind);  //---지지(월지)
		subj = sj_dj; djsjj = jiji.filter(isFind);  //---지지(일지)
		subj = sj_tj; 	tjsjj = jiji.filter(isFind);  //---지지(시지)

		jjsjj.unshift(tjsjj[0]);  //---지지배열(시지) 추가
		jjsjj.unshift(djsjj[0]);  //---지지배열(일지) 추가
		jjsjj.unshift(mjsjj[0]);  //---지지배열(월지) 추가
		jjsjj.unshift(yjsjj[0]);  //---지지배열(년지) 추가
		jjsjj.unshift(sstit[0]);  //---지지배열 + 이름 추가
		//------ 만들어진 지지배열 ------
		/*	0: (16) ["지지", "지지h", "오행", "음양", "이름", "색", "여기", "중기", "정기", "충", "육합", "육화", "삼합", "삼화", "방합", "방화"]
			1: (16) ["오", "午", "화", "음", "오음화", "#f00", "병10", "기9", "정11", "자", "미", "화", "인술", "화", "사미", "화"]
			2: (16) ["해", "亥", "수", "양", "해양수", "#999", "무7", "갑7", "임16", "사", "인", "목", "묘미", "목", "자축", "수"]
			3: (16) ["오", "午", "화", "음", "오음화", "#f00", "병10", "기9", "정11", "자", "미", "화", "인술", "화", "사미", "화"]
			4: (16) ["자", "子", "수", "음", "자음수", "#999", "임10", "", "계20", "오", "축", "토", "신진", "수", "해축", "수"]	*/

		//==== 십성 간(년,월,일,시) 지(년,월,일,시) 배열 만들기 ====
		sstit = sibsungX1.slice(0, 2);  //---십성배열 이름 (천간:첫째줄, 지지:둘째줄) 가져오기
		subj = sj_yg; ygssg = sibsungX1.filter(isFind);  //---십성(년간)
		subj = sj_mg; mgssg = sibsungX1.filter(isFind);  //---십성(월간)
		subj = sj_dg; dgssg = sibsungX1.filter(isFind);  //---십성(일간)
		subj = sj_tg; tgssg = sibsungX1.filter(isFind);  //---십성(시간)
		subj = sj_yj; yjssj = sibsungX1.filter(isFindj);  //---십성(년지)
		subj = sj_mj; mjssj = sibsungX1.filter(isFindj);  //---십성(월지)
		subj = sj_dj; djssj = sibsungX1.filter(isFindj);  //---십성(일지)
		subj = sj_tj; 	tjssj = sibsungX1.filter(isFindj);  //---십성(시지)

		gjsgj.unshift(tjssj[0]);  //---십성배열(시지) 추가
		gjsgj.unshift(djssj[0]);  //---십성배열(일지) 추가
		gjsgj.unshift(mjssj[0]);  //---십성배열(월지) 추가
		gjsgj.unshift(yjssj[0]);  //---십성배열(년지) 추가
		gjsgj.unshift(tgssg[0]);  //---십성배열(시간) 추가
		gjsgj.unshift(dgssg[0]);  //---십성배열(일간) 추가
		gjsgj.unshift(mgssg[0]);  //---십성배열(월간) 추가
		gjsgj.unshift(ygssg[0]);  //---십성배열(년간) 추가
		gjsgj.unshift(sstit[1]);  //---십성배열 + 지지이름 추가
		gjsgj.unshift(sstit[0]);  //---십성배열 + 천간이름 추가
		//------ 만들어진 십성배열 ------
		/*	0: (13) ["xx", "xx", "gn", "갑", "을", "병", "정", "무", "기", "경", "신", "임", "계"]
			1: (13) ["gn", "jj", "oh", "인", "묘", "사", "오", "진술", "축미", "신", "유", "해", "자"]
			2: (13) ["갑", "인", "양목", "비견", "겁재", "식신", "상관", "편재", "정재", "편관", "정관", "편인", "정인"]
			3: (13) ["을", "묘", "음목", "겁재", "비견", "상관", "식신", "정재", "편재", "정관", "편관", "정인", "편인"]
			4: (13) ["경", "신", "양금", "편재", "정재", "편관", "정관", "편인", "정인", "비견", "겁재", "식신", "상관"]
			5: (13) ["병", "사", "양화", "편인", "정인", "비견", "겁재", "식신", "상관", "편재", "정재", "편관", "정관"]
			6: (13) ["정", "오", "음화", "정인", "편인", "겁재", "비견", "상관", "식신", "정재", "편재", "정관", "편관"]
			7: (13) ["임", "해", "양수", "식신", "상관", "편재", "정재", "편관", "정관", "편인", "정인", "비견", "겁재"]
			8: (13) ["정", "오", "음화", "정인", "편인", "겁재", "비견", "상관", "식신", "정재", "편재", "정관", "편관"]
			9: (13) ["계", "자", "음수", "상관", "식신", "정재", "편재", "정관", "편관", "정인", "편인", "겁재", "비견"]	*/
};

function find_ggss(gan,css,jjg,no){
	idx = gjsgj[0].lastIndexOf(gan);
	document.getElementById(css).innerText += jjg + " " + gjsgj[no][idx] + "\n";
};

function find_gjss(ji,css,no){
	idx = gjsgj[1].lastIndexOf(ji);
	document.getElementById(css).innerText += gjsgj[no][idx] + "\n";
};



//---- 통근체크 ----

function ganji_root(){

	//------ 모든 천간의 통근 확인 -----------
	document.getElementById("output2").innerText += "(위치 가중치: 10 7 4 1 월지13 일지12 기본10) \n";
	ssg1_find("년간",gjsgj[2],"비견","겁재","편인","정인","output2");
	ssg1_find("월간",gjsgj[3],"비견","겁재","편인","정인","output2");
	ssg1_find("일간",gjsgj[4],"비견","겁재","편인","정인","output2");
	ssg1_find("시간",gjsgj[5],"비견","겁재","편인","정인","output2");
	
};

//========== 천간의 통근을 확인하는 함수 ==========
function ssg1_find(a,b,c,d,e,f,g) {
	tit = ""; cfm = ""; eff1 = 0; eff2 = 0; eff3 = 0; eff4 = 0; eff0 = 0;
	efft = 0; 
		idx = b.lastIndexOf(c); tit += gjsgj[0][idx];
		idx = b.lastIndexOf(d); tit += gjsgj[0][idx];
		idx = b.lastIndexOf(e); tit += gjsgj[0][idx];
		idx = b.lastIndexOf(f); tit += gjsgj[0][idx];		

	for (i=1;i<5 ; i++){
		if (tit.includes(jjsjj[i][8].substr(0,1))==true){document.getElementById(g).innerText += i + ".... 지장간 " + jjsjj[i][8] + "\n"; cfm += "kj"; eval('eff' + i + ' += Number(jjsjj[i][8].substr(1,2))');};
		if (jjsjj[i][7] != "" && tit.includes(jjsjj[i][7].substr(0,1))==true){document.getElementById(g).innerText += i + ".... 지장간b " + jjsjj[i][7] + "\n"; cfm += "kj"; eval('eff' + i + ' += Number(jjsjj[i][7].substr(1,2))');};
		if (tit.includes(jjsjj[i][6].substr(0,1))==true){document.getElementById(g).innerText += i + ".... 지장간a " + jjsjj[i][6] + "\n"; cfm += "kj"; eval('eff' + i + ' += Number(jjsjj[i][6].substr(1,2))');};
	};

	if (a == "년간"){eff0 = eff1 + (eff2 *1.3 * 0.7) + (eff3 * 1.2 * 0.4) + (eff4 * 0.1);};
	if (a == "월간"){eff0 = (eff2 *1.3) + (eff3 *1.2 * 0.7) + (eff4 * 0.4) + (eff1 * 0.7);};
	if (a == "일간"){eff0 = (eff3 *1.2) + (eff2 *1.3 * 0.7) + (eff4 * 0.7) + (eff1 * 0.4);};
	if (a == "시간"){eff0 = eff4 + (eff3 *1.2 * 0.7) + (eff2 * 1.3 * 0.4) + (eff1 * 0.1);	};
	efft = parseInt(eff0 / 30 * 100);
	document.getElementById("output2").innerText += ".............................." + a + " " + b[0] + " 통근 " + String(efft) + "%\n";
};	
	





  </script>

    </body>
</html>
